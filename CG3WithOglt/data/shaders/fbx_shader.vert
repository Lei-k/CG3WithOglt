#version 330

uniform struct Matrices
{
	mat4 projMatrix;
	mat4 modelMatrix;
	mat4 viewMatrix;                                                                           
	mat4 normalMatrix;
} matrices;

layout (location = 0) in vec3 inPosition;
layout (location = 1) in vec4 inColor;
layout (location = 2) in vec3 inNormal;
layout (location = 3) in vec2 inCoord;
layout (location = 4) in ivec4 boneIndices;
layout (location = 5) in vec4 boneWeights;

const int MAX_BONES = 300;

uniform mat4 gBones[MAX_BONES];

smooth out vec4 vColor;
smooth out vec3 vNormal;
smooth out vec2 vTexCoord;
smooth out vec3 vWorldPos;

smooth out vec4 vEyeSpacePos;

mat4 boneAtI(int i){
	if(i == 0) return gBones[0];
	else if(i == 1) return gBones[1];
	else if(i == 2) return gBones[1];
	else if(i == 3) return gBones[1];
	else if(i == 4) return gBones[1];
	else if(i == 5) return gBones[1];
	else if(i == 6) return gBones[1];
	else if(i == 7) return gBones[1];
	else if(i == 8) return gBones[1];
	else if(i == 9) return gBones[1];
	else if(i == 10) return gBones[1];
	else if(i == 11) return gBones[1];
	else if(i == 12) return gBones[1];
	else if(i == 13) return gBones[1];
	else if(i == 14) return gBones[1];
	else if(i == 15) return gBones[1];
	else if(i == 16) return gBones[1];
	else if(i == 17) return gBones[1];
	else if(i == 18) return gBones[1];
	else if(i == 19) return gBones[1];
	else if(i == 20) return gBones[1];
	else if(i == 21) return gBones[1];
	else if(i == 22) return gBones[1];
	else if(i == 23) return gBones[1];
	else if(i == 24) return gBones[1];
	else if(i == 25) return gBones[1];
	else if(i == 26) return gBones[1];
	else if(i == 27) return gBones[1];
	else if(i == 28) return gBones[1];
	else if(i == 29) return gBones[1];
	else if(i == 30) return gBones[1];
	else if(i == 31) return gBones[1];
	else if(i == 32) return gBones[1];
	else if(i == 33) return gBones[1];
	else if(i == 34) return gBones[1];
	else if(i == 35) return gBones[1];
	else if(i == 36) return gBones[1];
	else if(i == 37) return gBones[1];
	else if(i == 38) return gBones[1];
	else if(i == 39) return gBones[1];
	else if(i == 40) return gBones[1];
	else if(i == 41) return gBones[1];
	else if(i == 42) return gBones[1];
	else if(i == 43) return gBones[1];
	else if(i == 44) return gBones[1];
	else if(i == 45) return gBones[1];
	else if(i == 46) return gBones[1];
	else if(i == 47) return gBones[1];
	else if(i == 48) return gBones[1];
	else if(i == 49) return gBones[1];
	else if(i == 50) return gBones[1];
	else if(i == 51) return gBones[1];
	else if(i == 52) return gBones[1];
	else if(i == 53) return gBones[1];
	else if(i == 54) return gBones[1];
	else if(i == 55) return gBones[1];
	else if(i == 56) return gBones[1];
	else if(i == 57) return gBones[1];
	else if(i == 58) return gBones[1];
	else if(i == 59) return gBones[1];
	else if(i == 60) return gBones[1];
	else if(i == 61) return gBones[1];
	else if(i == 62) return gBones[1];
	else if(i == 63) return gBones[1];
	else if(i == 64) return gBones[1];
	else if(i == 65) return gBones[1];
	else if(i == 66) return gBones[1];
	else if(i == 67) return gBones[1];
	else if(i == 68) return gBones[1];
	else if(i == 69) return gBones[1];
	else if(i == 70) return gBones[1];
	else if(i == 71) return gBones[1];
	else if(i == 72) return gBones[1];
	else if(i == 73) return gBones[1];
	else if(i == 74) return gBones[1];
	else if(i == 75) return gBones[1];
	else if(i == 76) return gBones[1];
	else if(i == 77) return gBones[1];
	else if(i == 78) return gBones[1];
	else if(i == 79) return gBones[1];
	else if(i == 80) return gBones[1];
	else if(i == 81) return gBones[1];
	else if(i == 82) return gBones[1];
	else if(i == 83) return gBones[1];
	else if(i == 84) return gBones[1];
	else if(i == 85) return gBones[1];
	else if(i == 86) return gBones[1];
	else if(i == 87) return gBones[1];
	else if(i == 88) return gBones[1];
	else if(i == 89) return gBones[1];
	else if(i == 90) return gBones[1];
	else if(i == 91) return gBones[1];
	else if(i == 92) return gBones[1];
	else if(i == 93) return gBones[1];
	else if(i == 94) return gBones[1];
	else if(i == 95) return gBones[1];
	else if(i == 96) return gBones[1];
	else if(i == 97) return gBones[1];
	else if(i == 98) return gBones[1];
	else if(i == 99) return gBones[1];
	else if(i == 100) return gBones[1];
	else if(i == 101) return gBones[1];
	else if(i == 102) return gBones[1];
	else if(i == 103) return gBones[1];
	else if(i == 104) return gBones[1];
	else if(i == 105) return gBones[1];
	else if(i == 106) return gBones[1];
	else if(i == 107) return gBones[1];
	else if(i == 108) return gBones[1];
	else if(i == 109) return gBones[1];
	else if(i == 110) return gBones[1];
	else if(i == 111) return gBones[1];
	else if(i == 112) return gBones[1];
	else if(i == 113) return gBones[1];
	else if(i == 114) return gBones[1];
	else if(i == 115) return gBones[1];
	else if(i == 116) return gBones[1];
	else if(i == 117) return gBones[1];
	else if(i == 118) return gBones[1];
	else if(i == 119) return gBones[1];
	else if(i == 120) return gBones[1];
	else if(i == 121) return gBones[1];
	else if(i == 122) return gBones[1];
	else if(i == 123) return gBones[1];
	else if(i == 124) return gBones[1];
	else if(i == 125) return gBones[1];
	else if(i == 126) return gBones[1];
	else if(i == 127) return gBones[1];
	else if(i == 128) return gBones[1];
	else if(i == 129) return gBones[1];
	else if(i == 130) return gBones[1];
	else if(i == 131) return gBones[1];
	else if(i == 132) return gBones[1];
	else if(i == 133) return gBones[1];
	else if(i == 134) return gBones[1];
	else if(i == 135) return gBones[1];
	else if(i == 136) return gBones[1];
	else if(i == 137) return gBones[1];
	else if(i == 138) return gBones[1];
	else if(i == 139) return gBones[1];
	else if(i == 140) return gBones[1];
	else if(i == 141) return gBones[1];
	else if(i == 142) return gBones[1];
	else if(i == 143) return gBones[1];
	else if(i == 144) return gBones[1];
	else if(i == 145) return gBones[1];
	else if(i == 146) return gBones[1];
	else if(i == 147) return gBones[1];
	else if(i == 148) return gBones[1];
	else if(i == 149) return gBones[1];
	else if(i == 150) return gBones[1];
	else if(i == 151) return gBones[1];
	else if(i == 152) return gBones[1];
	else if(i == 153) return gBones[1];
	else if(i == 154) return gBones[1];
	else if(i == 155) return gBones[1];
	else if(i == 156) return gBones[1];
	else if(i == 157) return gBones[1];
	else if(i == 158) return gBones[1];
	else if(i == 159) return gBones[1];
	else if(i == 160) return gBones[1];
	else if(i == 161) return gBones[1];
	else if(i == 162) return gBones[1];
	else if(i == 163) return gBones[1];
	else if(i == 164) return gBones[1];
	else if(i == 165) return gBones[1];
	else if(i == 166) return gBones[1];
	else if(i == 167) return gBones[1];
	else if(i == 168) return gBones[1];
	else if(i == 169) return gBones[1];
	else if(i == 170) return gBones[1];
	else if(i == 171) return gBones[1];
	else if(i == 172) return gBones[1];
	else if(i == 173) return gBones[1];
	else if(i == 174) return gBones[1];
	else if(i == 175) return gBones[1];
	else if(i == 176) return gBones[1];
	else if(i == 177) return gBones[1];
	else if(i == 178) return gBones[1];
	else if(i == 179) return gBones[1];
	else if(i == 180) return gBones[1];
	else if(i == 181) return gBones[1];
	else if(i == 182) return gBones[1];
	else if(i == 183) return gBones[1];
	else if(i == 184) return gBones[1];
	else if(i == 185) return gBones[1];
	else if(i == 186) return gBones[1];
	else if(i == 187) return gBones[1];
	else if(i == 188) return gBones[1];
	else if(i == 189) return gBones[1];
	else if(i == 190) return gBones[1];
	else if(i == 191) return gBones[1];
	else if(i == 192) return gBones[1];
	else if(i == 193) return gBones[1];
}

void main()
{
  mat4 mMV = matrices.viewMatrix*matrices.modelMatrix;  
  mat4 mMVP = matrices.projMatrix*matrices.viewMatrix*matrices.modelMatrix;
  
  vColor = inColor;
  vTexCoord = inCoord;

  int index1 = int(boneIndices[0]);
  int index2 = int(boneIndices[1]);
  mat4 boneTransform = boneAtI(boneIndices[0]) * boneWeights[0] + boneAtI(boneIndices[1]) * boneWeights[1];
  //+ gBones[boneIndices[2]] * boneWeights[2]
  //+ gBones[boneIndices[3]] * boneWeights[3];

  vEyeSpacePos = mMV * boneTransform * vec4(inPosition, 1.0);
  gl_Position = mMVP * boneTransform * vec4(inPosition, 1.0);

  vNormal = (matrices.normalMatrix * vec4(inNormal, 1.0)).xyz;
  vWorldPos = (matrices.modelMatrix * vec4(inPosition, 1.0)).xyz;
}